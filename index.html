<!DOCTYPE html>
<html lang="sv">
<head>
<meta charset="UTF-8">
<title>VÃ¤derklocka</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
* { box-sizing: border-box; }
html, body { height: 100%; margin: 0; }

body{
  font-family: Arial, sans-serif;
  background:#fff;
  color:#000;
  display:flex;
  flex-direction:column;
  align-items:center;
  overflow:hidden;
}

/* ===== KLOCKA ===== */
#clock{
  font-size:30vw;
  line-height:0.9;
  margin:2vh 0 1vh 0;
  z-index:5;
}

/* ===== KOLUMNER ===== */
.columns{
  display:flex;
  width:100%;
  height:100%;
}

.left,.right{
  flex:1;
  position:relative;
  overflow:hidden; /* ðŸ”´ superviktigt */
}

/* ===== VÃ„DERSYMBOLER ===== */
.weather-icon{
  position:absolute;
  top:3vh !important;
  left:50% !important;
  transform:translateX(-50%) !important;

  height:32vh !important;     /* ðŸ”´ fysisk begrÃ¤nsning */
  width:auto !important;
  max-width:100% !important;

  object-fit:contain !important;
  filter:blur(5px) brightness(0.9) saturate(0.9) !important;
  opacity:0.35 !important;

  z-index:1 !important;
  pointer-events:none;
}

/* ===== TEMPERATURER ===== */
.temp-now,
.temp-forecast{
  position:absolute !important;
  bottom:3vh !important;
  left:0 !important;
  width:100% !important;

  text-align:center;
  font-size:11vw !important;
  z-index:3 !important;

  padding:0.2em 0.6em;
  border-radius:18px;
  background:rgba(255,255,255,0.35);

  text-shadow:
    0 0 10px rgba(0,0,0,0.45),
    0 0 20px rgba(0,0,0,0.25);
}

/* ===== PROGNOSTID ===== */
.forecast-time{
  position:absolute;
  top:38vh;
  width:100%;
  text-align:center;
  font-size:5vw;
  opacity:0.8;
  z-index:2;
}

/* ===== BAKGRUNDER ===== */
:root{ --left-bg:#fff; --right-bg:#fff; }
body::before{
  content:'';
  position:fixed;
  inset:0;
  background:linear-gradient(
    to right,
    var(--left-bg) 0 50%,
    var(--right-bg) 50% 100%
  );
  z-index:-1;
}

/* ===== TESTKNAPP ===== */
.test-speak{
  position:fixed;
  right:12px;
  bottom:12px;
  padding:14px 18px;
  font-size:16px;
  border-radius:14px;
  border:none;
  background:#111;
  color:#fff;
  z-index:1000;
}
</style>
</head>

<body>

<div id="clock">--:--</div>

<div class="columns">
  <div class="left">
    <img id="now-icon" class="weather-icon" src="">
    <div id="temp-now" class="temp-now">-- Â°C</div>
  </div>

  <div class="right">
    <img id="forecast-icon" class="weather-icon" src="">
    <div id="forecast-time" class="forecast-time">--:--</div>
    <div id="temp-forecast" class="temp-forecast">-- Â°C</div>
  </div>
</div>

<button class="test-speak" onclick="announceOnce()">ðŸ”Š Testa tal nu</button>

<audio id="tts-audio"></audio>

<script>
/* ================== KLOCKA ================== */
function updateClock(){
  const n=new Date();
  clock.textContent=n.toLocaleTimeString('sv-SE',{hour:'2-digit',minute:'2-digit'});
}
setInterval(updateClock,1000);
updateClock();

/* ================== FÃ„RGER ================== */
function bg(temp){
  if(temp<=0) return '#3399ff';
  if(temp<=10) return '#66ffcc';
  if(temp<=20) return '#cddc39';
  if(temp<=30) return '#ff9800';
  return '#f44336';
}

/* ================== VÃ„DER ================== */
async function fetchWeather(){
  const key='520bfebd2e95a6b1a08befe3286c9ca1';
  const city='Bromma,SE';

  const n=await fetch(`https://api.openweathermap.org/data/2.5/weather?q=${city}&units=metric&lang=sv&appid=${key}`).then(r=>r.json());
  const f=await fetch(`https://api.openweathermap.org/data/2.5/forecast?q=${city}&units=metric&lang=sv&appid=${key}`).then(r=>r.json());

  const tNow=Math.round(n.main.temp);
  temp-now.textContent=`${tNow} Â°C`;
  now-icon.src=`https://openweathermap.org/img/wn/${n.weather[0].icon}@4x.png`;
  temp-now.style.color=tNow<=0?'#3399ff':'#e60000';
  document.documentElement.style.setProperty('--left-bg',bg(tNow));

  const fc=f.list[1];
  const tFc=Math.round(fc.main.temp);
  temp-forecast.textContent=`${tFc} Â°C`;
  forecast-icon.src=`https://openweathermap.org/img/wn/${fc.weather[0].icon}@4x.png`;
  forecast-time.textContent=new Date(fc.dt*1000).toLocaleTimeString('sv-SE',{hour:'2-digit',minute:'2-digit'});
  temp-forecast.style.color=tFc<=0?'#3399ff':'#e60000';
  document.documentElement.style.setProperty('--right-bg',bg(tFc));

  return {
    nowTemp:n.main.temp,
    nowDesc:n.weather[0].description,
    forecast:f.list
  };
}
fetchWeather();
setInterval(fetchWeather,10*60*1000);

/* ================== TAL ================== */
let unlocked=false;
function unlock(){
  unlocked=true;
  const a=new AudioContext();
  const o=a.createOscillator();
  o.connect(a.destination);
  o.start(); o.stop(a.currentTime+0.05);
}

async function speak(text){
  if(!unlocked) unlock();
  const url=`https://api.voicerss.org/?key=ER_SÃ„TT_MED_DIN_API_NYCKEL&hl=sv-se&src=${encodeURIComponent(text)}`;
  tts-audio.src=url;
  await tts-audio.play();
}

function summarize(data){
  const temps=data.forecast.slice(0,8).map(x=>x.main.temp);
  return `Just nu Ã¤r det ${Math.round(data.nowTemp)} grader och ${data.nowDesc}. Under dagen mellan ${Math.round(Math.min(...temps))} och ${Math.round(Math.max(...temps))} grader.`;
}

async function announceOnce(){
  const d=await fetchWeather();
  speak(summarize(d));
}
</script>

</body>
</html>
