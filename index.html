
<!DOCTYPE html>
<html lang="sv">
<head>
  <meta charset="UTF-8">
  <title>Väderklocka</title>
  <style>
    * {
      box-sizing: border-box;
    }
    body {
      margin: 0;
      font-family: Arial, sans-serif;
      display: flex;
      flex-direction: column;
      align-items: center;
      height: 100vh;
      transition: background-color 1s ease, color 1s ease;
    }
    #clock {
      font-size: 25vw; text-align: center;
      margin: 20px 0 10px 0;
    }
    .columns {
      display: flex;
      width: 100%;
      height: 100%;
    }
    .left, .right {
      flex: 1;
      position: relative;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: flex-start;
      padding-top: 30px;
    }
    .weather-icon {
      width: 100%;
      height: auto;
      filter: drop-shadow(0 0 4px black);
      position: absolute;
      top: 0;
      left: 0;
      z-index: 0;
    }
    .temp-now, .temp-forecast {
      font-size: 8vw;
      position: absolute;
      top: 50%;
      width: 100%;
      text-align: center;
      z-index: 1;
      margin-top: 20px;
    }
    .forecast-time {
      font-size: 5vw;
      margin-top: 10px;
      opacity: 0.8;
    }
  </style>
</head>
<body>
  <div id="clock">--:--</div>

  <div class="columns">
    <div class="left">
      <img id="now-icon" src="" class="weather-icon" alt="väder nu">
      <div id="temp-now" class="temp-now">-- °C</div>
    </div>
    <div class="right">
      <img id="forecast-icon" src="" class="weather-icon" alt="prognos">
      <div id="forecast-time" class="forecast-time">--:--</div>
      <div id="temp-forecast" class="temp-forecast">-- °C</div>
    </div>
  </div>

  <script>
    function updateClock() {
      const now = new Date();
      const time = now.toLocaleTimeString('sv-SE', {
        hour: '2-digit',
        minute: '2-digit',
        hour12: false
      });
      document.getElementById('clock').textContent = time;
    }

    function hexToRgb(hex) {
      const bigint = parseInt(hex.slice(1), 16);
      return {
        r: (bigint >> 16) & 255,
        g: (bigint >> 8) & 255,
        b: bigint & 255
      };
    }

    function getTextColorForBackground(hex) {
      const { r, g, b } = hexToRgb(hex);
      const luminance = 0.299 * r + 0.587 * g + 0.114 * b;
      return luminance > 186 ? 'black' : 'white';
    }

    function getBackgroundColor(temp) {
      if (temp <= -20)         return '#001d4a';
      else if (temp <= -15)    return '#003b8b';
      else if (temp <= -10)    return '#005fc1';
      else if (temp <= -5)     return '#3399ff';
      else if (temp <= 0)      return '#33cccc';
      else if (temp <= 5)      return '#66ffcc';
      else if (temp <= 10)     return '#a8e6cf';
      else if (temp <= 15)     return '#66bb6a';
      else if (temp <= 20)     return '#cddc39';
      else if (temp <= 23)     return '#fff176';
      else if (temp <= 26)     return '#ffc107';
      else if (temp <= 30)     return '#ff9800';
      else if (temp <= 35)     return '#ff5722';
      else                     return '#f44336';
    }

    async function fetchWeather() {
      const apiKey = '520bfebd2e95a6b1a08befe3286c9ca1';
      const city = 'Bromma,SE';
      const urlNow = `https://api.openweathermap.org/data/2.5/weather?q=${city}&appid=${apiKey}&units=metric`;
      const urlForecast = `https://api.openweathermap.org/data/2.5/forecast?q=${city}&appid=${apiKey}&units=metric`;

      try {
        const resNow = await fetch(urlNow);
        const dataNow = await resNow.json();
        const tempNow = Math.round(dataNow.main.temp);
        const iconNow = dataNow.weather[0].icon;
        document.getElementById('temp-now').textContent = `${tempNow} °C`;
        document.getElementById('now-icon').src = `https://openweathermap.org/img/wn/${iconNow}@4x.png`;

        const bg = getBackgroundColor(tempNow);
        const fg = getTextColorForBackground(bg);
        document.body.style.backgroundColor = bg;
        document.body.style.color = fg;

        const resForecast = await fetch(urlForecast);
        const dataForecast = await resForecast.json();
        const forecast = dataForecast.list[1];
        const tempForecast = Math.round(forecast.main.temp);
        const iconForecast = forecast.weather[0].icon;
        const time = new Date(forecast.dt * 1000).toLocaleTimeString('sv-SE', {
          hour: '2-digit',
          minute: '2-digit',
          hour12: false
        });

        document.getElementById('temp-forecast').textContent = `${tempForecast}°C`;
        document.getElementById('forecast-icon').src = `https://openweathermap.org/img/wn/${iconForecast}@4x.png`;
        document.getElementById('forecast-time').textContent = time;

      } catch (err) {
        console.error("Fel vid hämtning:", err);
      }
    }

    updateClock();
    fetchWeather();
    setInterval(updateClock, 1000);
    setInterval(fetchWeather, 10 * 60 * 1000);
  </script>
</body>
</html>
